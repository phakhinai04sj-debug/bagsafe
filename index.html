<script>

let currentLang="th";
let selectedItems=new Set();
let resetTimer=null;

const alertSound=new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");
const infoSound=new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");

function renderCards(){
  const container=document.getElementById("cards");
  container.innerHTML="";

  translations[currentLang].items.forEach((item,index)=>{

    const card=document.createElement("div");
    card.className="card";

    card.innerHTML=`
      <img src="${icons[index]}" 
      onerror="this.src='https://img.icons8.com/fluency/96/help.png'">
      <p>${item}</p>
    `;

    if(selectedItems.has(index)){
      card.classList.add("selected");
    }

    card.onclick=()=>toggleItem(index);

    container.appendChild(card);
  });
}

function toggleItem(index){

  if(selectedItems.has(index)){
    selectedItems.delete(index);
  }else{
    selectedItems.add(index);
  }

  renderCards();
  updateMessage();

  clearTimeout(resetTimer);
  resetTimer=setTimeout(resetAll,20000);
}

function updateMessage(){

  const msg=document.getElementById("message");
  msg.classList.remove("alert");

  if(selectedItems.size===0){
    msg.innerText="";
    return;
  }

  // ถ้ามีรายการ "ไม่แน่ใจ"
  if(selectedItems.has(8) && selectedItems.size===1){
    msg.innerText=translations[currentLang].ask;
    infoSound.play();
    return;
  }

  msg.innerText=translations[currentLang].warning;
  msg.classList.add("alert");
  alertSound.play();
}

function resetAll(){
  selectedItems.clear();
  document.getElementById("message").innerText="";
  document.getElementById("message").classList.remove("alert");
  renderCards();
}

function changeLang(lang){
  currentLang=lang;
  selectedItems.clear();

  document.getElementById("title").innerText=translations[lang].title;
  document.getElementById("instruction").innerText=translations[lang].instruction;
  document.getElementById("message").innerText="";
  document.getElementById("message").classList.remove("alert");

  renderCards();
}

changeLang("th");

</script>
